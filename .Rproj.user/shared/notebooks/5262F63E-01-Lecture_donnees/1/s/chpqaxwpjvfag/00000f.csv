"0","### Importer et nettoyer les données récentes (2018-2020) par l'ensemble des partenaires."
"0","#recent.long <- read.csv(here(""donnees/recent/AB_2018-2020/WQI_AB_2022_Results.csv""), sep="";"", dec=""."") %>%"
"0","  # mutate(Date = as.Date(parse_date_time(Date, orders = c(""ymd"", ""dmy"", ""ymd HMS"", ""dmy HMS"")))) %>% "
"0","  # select(Station, Date, Year)"
"0",""
"0","# Créer la liste des fichiers xls du dossier de données"
"0","file_list <- list.files(""donnees/sorties_calculateur/"", pattern = "".xls"")"
"0",""
"0","# Importer les fichiers xls du dossier de données"
"0","recent_liste <- lapply(file_list, function(x) readxl::read_xls(paste(""donnees/Sorties_calculateur/"",x, sep = """"), sheet = 1))"
"0",""
"0","# Ne conserver que les deux premières colonnes"
"0","recent_liste_long <- map(recent_liste, ~ select(., Station, Date))"
"0",""
"0","# Si une erreur survient à cette étape, il est probable que les entêtes des fichiers Excel sont différents"
"0","recent_combine <- do.call(""rbind"", recent_liste_long)"
"0",""
"0","recent_long <- recent_combine %>% "
"0","    mutate(Annee = year(Date), Cle = paste(Station, Date, sep = ""_"")) %>% "
"0","    unique() %>% "
"0","    mutate(Mois = month(Date),"
"0","           Jour = day(Date))"
"0",""
"0","# Ajout des saison"
"0","# La définition des saisons est basée sur les saisons climatiques et correspond à:"
"0","# - Printemps = mars, avril, mai"
"0","# - Été = juin, juillet, août"
"0","# - Automne = septembre, octobre, novembre"
"0","# - Hiver = décembre, janvier, février"
"0","recent_long$Saison <- case_when( "
"0","    recent_long$Mois %in% c(6,7,8) ~ ""Summer"","
"0","    recent_long$Mois %in% c(9,10,11) ~ ""Fall"","
"0","    recent_long$Mois %in% c(1,2,12) ~ ""Winter"","
"0","    recent_long$Mois %in% c(3,4,5) ~ ""Spring"""
"0",")"
"0",""
"0","# Ajout des colonnes manquantes à partir de la table dictionnaire"
"0",""
"0","recent_long_nettoye <- recent_long %>% "
"0","  left_join(table_dictionnaire, by = ""Station"") %>% "
"0","  select(-Core) # supprimer colonne superflue"
"0",""
"0","#write_csv2(recent_long_nettoye, ""donnees/Sorties_calculateur/Tableau_sorties_long.csv"")"
"0","write_csv2(recent_long_nettoye, ""donnees/Compilation_saisonniere/donnees_saisonnieres.csv"")"
