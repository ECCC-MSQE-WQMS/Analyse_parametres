"0",""
"0","### Importer et nettoyer les données récentes (2018-2020) par l'ensemble des partenaires."
"0",""
"0","# Créer la liste des fichiers xls du dossier de données"
"0","liste_fichiers_sortie <- list.files(""donnees/"", pattern = "".xls"", full.names = TRUE, recursive = TRUE, include.dirs = FALSE)"
"0",""
"0","# Importer les fichiers xls du dossier de données"
"0","liste_tableaux_sortie <- lapply(liste_fichiers_sortie, function(x) readxl::read_xls(x, sheet = 1))"
"0",""
"0","# Ne conserver que les deux premières colonnes"
"0","# recent_liste_nettoye <- map(recent_liste, ~ select(., -INDEXPERIOD, -TEMP, -PH, -HARDNESS))"
"0",""
"0","# Transformation en format long"
"0","liste_tableaux_sortie_long <- map(liste_tableaux_sortie, ~ pivot_longer(., cols = -c(Station, Date, INDEXPERIOD, TEMP, PH), names_to = ""Parametre"", values_to = ""Valeur"", values_drop_na = TRUE))"
"0",""
"0","# Si une erreur survient à cette étape, il est probable que les entêtes des fichiers Excel sont différents"
"0","tableau_sortie_long <- do.call(""rbind"", liste_tableaux_sortie_long)"
"0","tableau_sortie_long$Date <- as.Date(tableau_sortie_long$Date)"
"0",""
"0","tableau_parametres_long <- tableau_sortie_long %>%"
"0","  mutate(Annee = year(Date), Cle = paste(Station, Date, sep = ""_"")) %>%"
"0","  # unique() %>%"
"0","  mutate("
"0","    Mois = month(Date),"
"0","    Jour = day(Date)"
"0","  ) %>%"
"0","  select(-INDEXPERIOD, -TEMP, -PH) %>%"
"0","  filter(Parametre!=""HARDNESS"")"
"0",""
"0","# Ajout des variables de la table dictionnaire"
"0","tableau_parametres_ok <- tableau_parametres_long %>% "
"0","  left_join(table_dictionnaire, by = ""Station"") %>% "
"0","  select(-Core) # supprimer colonne superflue"
"0",""
"0","# Ajout de la saison"
"0","tableau_parametres_ok$Saison <- case_when( "
"0","    tableau_parametres_ok$Mois %in% c(6,7,8) ~ ""Summer"","
"0","    tableau_parametres_ok$Mois %in% c(9,10,11) ~ ""Fall"","
"0","    tableau_parametres_ok$Mois %in% c(1,2,12) ~ ""Winter"","
"0","    tableau_parametres_ok$Mois %in% c(3,4,5) ~ ""Spring"""
"0",")"
"0",""
"0",""
"0","write.csv2(tableau_parametres_ok, ""resultats/Tableau_parametres_long.csv"", row.names = FALSE, fileEncoding = ""UTF-8"")"
"0","saveRDS(tableau_parametres_long, ""resultats/Tableau_parametres_long.RDS"")"
"0",""
